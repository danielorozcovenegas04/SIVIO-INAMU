
@model SIVIO.UI.Models.ExpedienteModel

@{
    Layout = null;
}

<script type="text/javascript">
    var instMensajes = $('[data-remodal-id=modalDialogo]').remodal();
    $(document).ready(function () {
        PrevenirCaracteresInvalidos();
        debugger;
        document.title = "SIVIO - Delegación de la Mujer";

        CargarDropdowns();
        CargarDivisionTerritorial();
        CargarEditorRedesApoyo();
        CargarEditorComposicionFamiliar();
        $("#btnGuardarDatosUsuaria").click(function () {
            debugger;

            var objDatosUsuaria = $();
            var objDatosUsuariaDireccion1 = $();
            var objDatosUsuariaDireccion2 = $();
            var objDatosUsuariaTelefono = $();
            objDatosUsuaria.VC_NOMBRE = $("#txtNombre").val();
            objDatosUsuaria.VC_APELLIDO1 = $("#txtApellido1").val();
            objDatosUsuaria.VC_APELLIDO2 = $("#txtApellido2").val();
            objDatosUsuaria.VC_IDENTIFICACION = $("#txtIdentificacion").val();
            objDatosUsuaria.DT_FECHANACIMIENTO = $("#txtFechaNacimiento").val();
            // Edad?
            objDatosUsuaria.FK_PROVINCIAPROCEDENCIA = $("#cmbPersonaProvincia").val();
            objDatosUsuaria.FK_CANTONPROCEDENCIA = $("#cmbPersonaCanton").val();
            objDatosUsuaria.FK_DISTRITOPROCEDENCIA = $("#cmbPersonaDistrito").val();
            // País de procedencia?
            // Falta agregarle Canton - distrito - provincia a este objDatosUsuariaDireccion1
            objDatosUsuariaDireccion1.VC_DETALLE = $("#txtDireccionDomicilio").val();
            // Falta agregarle Canton - distrito - provincia a este objDatosUsuariaDireccion2
            objDatosUsuariaDireccion2.VC_DETALLE = $("#txtDireccionNotificaciones").val();
            objDatosUsuaria.VC_CORREO = $("#txtCorreoElectronico").val();
            objDatosUsuariaTelefono.VC_NUMERO = $("#txtTelefono").val();
            objDatosUsuaria.FK_ESTADOCIVIL = $("#cmbCondicionCivil").val();
            objDatosUsuaria.FK_ESCOLARIDAD = $("#cmbEscolaridad").val();
            objDatosUsuaria.I_HIJOS = $("#txtNumeroHijos").val();
            objDatosUsuaria.FK_NACIONALIDAD = $("#cmbNacionalidad").val();
            objDatosUsuaria.FK_NACIONALIDAD2 = $("#cmbOtraNacionalidad").val();
            // Agregados extra

            // Apátrida?
            objDatosUsuaria.FK_CONDICIONMIGRATORIA = $("#cmbCondicionMigratoria").val();
            objDatosUsuaria.FK_OCUPACION = $("#cmbOcupacion").val();
            objDatosUsuaria.TBL_ADICCIONES = [];
            //objDatosUsuaria.TBL_ADICCIONES.push({ FK_TIPOADICCION: 3 });
            $.ajax(
            {
                type: "POST",
                dataType: "json",
                contentType: "application/json",
                url: '@Url.Action("CrearUsuaria_DatosUsuaria")', // Controller/View
                data: JSON.stringify({
                    objDatosUsuaria: objDatosUsuaria
                }),

            });

        });

    });

    function InicializarCategoriasRiesgo() {
        $("#dvCatPrec").show();
        $("#dvCatSevRiesgo").hide();
        $("#dvCatAltoRiesgo").hide();
    }
    function CargarDropdowns() {

        $.ajax({
            type: "POST",
            url: '@Url.Action("CargarDropdowns")',
            dataType: "json",
            contentType: "application/json",
            processData: true,
            success: function (resultado) {
                debugger;
                var respuesta = JSON.parse(resultado);
                if (respuesta.Mensaje.TipoMensaje === 1) {
      
                    $.each(respuesta.CatalogoNacionalidad, function (key, value) {
                        $('#cmbApatrida').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                        $('#cmbOtraNacionalidad').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                        $('#cmbNacionalidad').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                        $('#cmbPaisProcedencia').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                        $('#cmbNacionalidadHistoria').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                    });
                    $.each(respuesta.CatalogoCondicionCivil, function (key, value) {
                        $('#cmbCondicionCivil').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                    });
                    $.each(respuesta.CatalogoEscolaridad, function (key, value) {
                        $('#cmbEscolaridad').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                        $('#cmbEscolaridadHistoria').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                        $('#cmbEscolaridadFamiliar').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                    });
                    $.each(respuesta.CatalogoEmbarazo, function (key, value) {
                        $('#cmbEmbarazo').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                    });
                    $.each(respuesta.CatalogoCondicionMigratoria, function (key, value) {
                        $('#cmbCondicionMigratoria').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                    });
                    $.each(respuesta.CatalogoOcupacion, function (key, value) {
                        $('#cmbOcupacion').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                        $('#cmbOcupacionHistoria').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                        $('#cmbOcupacionFamiliar').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                    });

                    $.each(respuesta.CatalogoIdentidadGenero, function (key, value) {
                        $('#cmbIdentidadGenero').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                        $('#cmbGeneroHistoria').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                    });
                    $.each(respuesta.CatalogoOrigenEtnico, function (key, value) {
                        $('#cmbOrigenEtnico').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                    });
                    $.each(respuesta.CatalogoCondicionLaboral, function (key, value) {
                        $('#cmbCondicionLaboral').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                    });
                    $.each(respuesta.CatalogoTipoFamilia, function (key, value) {
                        $('#cmbTipoFamilia').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                    });
                    $.each(respuesta.CatalogoTipoVivienda, function (key, value) {
                        $('#cmbTipoVivienda').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                    });
					$.each(respuesta.CatalogoOrientacionSexual, function (key, value) {
                        $('#cmbOrientacionSexual').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                    });
					$.each(respuesta.CatalogoCondicionAseguramiento, function (key, value) {
                        $('#cmbCondicionAseguramiento').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                    });
                    $.each(respuesta.CatalogoParentesco, function (key, value) {
                        $('#cmbParentescoFamiliar').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                    });

                    $.each(respuesta.CatalogoTipoAtencion, function (key, value) {
                        $('#txtTipoAten').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                    });

                    $.each(respuesta.CatalogoViolencia, function (key, value) {
                        $('#cmbTipoViolencia').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                    });
                    $('#cmbTipoViolencia').selectize({
                        sortField: 'text'
                    });

                    $.each(respuesta.Padecimientos, function (key, value) {
                        $('#cmbCondSalud').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                    });

                    $('#cmbCondSalud').selectize({
                        sortField: 'text'
                    });

                    $.each(respuesta.Adicciones, function (key, value) {
                        $('#cmdAdicciones').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                    });

                    $('#cmdAdicciones').selectize({
                        sortField: 'text'
                    });

                    $.each(respuesta.TipoRedApoyo, function (key, value) {
                        $('#cmdTipoRedApoyo').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                    });
                    $.each(respuesta.Institucion, function (key, value) {
                        $('#cmdInstitucionRedApoyo').append($("<option/>", {
                            value: value.PK_VALORCATALOGO,
                            text: value.VC_VALOR1
                        }));
                    });


                    $('#btn-login').fadeIn();
                    $.LoadingOverlay("hide");
                } else {
                    $("#contenedorBotones").show();
                    $("#contenedorEspera").hide();
                    $("#txtModalTitulo").css("color", "red");
                    $("#txtModalTitulo").text("Error");
                    $("#txtModalContenido").text(respuesta.Mensaje.ContenidoMensaje);
                    instMensajes.open();
                    $.LoadingOverlay("hide");


                }



            },
            error: function (xhr, ajaxOptions, error) {
                $("#contenedorBotones").show();
                $("#contenedorEspera").hide();
                $("#txtModalTitulo").css("color", "red");
                $("#txtModalTitulo").text("Error al registrar");
                $("#txtModalContenido").text("Fallo al comunicarse con el servidor");
                instMensajes.open();
                $.LoadingOverlay("hide");

            }
        });
    }

    function CargarDivisionTerritorial() {
        var divisionTerritorial = JSON.parse(localStorage.getItem('divisionTerritorial'));
        $("#cmbPersonaProvincia")
            .change(function () {
                debugger;
                $('#cmbPersonaCanton').find('option').remove().end();
                $('#cmbPersonaDistrito').find('option').remove().end();
                var personaProvinciaSel = $("#cmbPersonaProvincia").val();
                for (var j = 0; j < divisionTerritorial[1].Value.length; j++) {
                    //console.log(data[0].Value[j].VC_DESCRIPCION);
                    if (divisionTerritorial[1].Value[j].I_IDPROVINCIA == personaProvinciaSel) {
                        $("#cmbPersonaCanton")
                            .append($("<option />")
                                .val(divisionTerritorial[1].Value[j].I_IDCANTON)
                                .text(divisionTerritorial[1].Value[j].VC_DESCRIPCION));
                    }

                }
                var personaCantonSel = $("#cmbPersonaCanton").val();
                for (var j = 0; j < divisionTerritorial[2].Value.length; j++) {
                    //console.log(data[0].Value[j].VC_DESCRIPCION);
                    if (divisionTerritorial[2].Value[j].I_IDCANTON == personaCantonSel &
                        divisionTerritorial[2].Value[j].I_IDPROVINCIA == personaProvinciaSel) {
                        $("#cmbPersonaDistrito")
                            .append($("<option />")
                                .val(divisionTerritorial[2].Value[j].I_IDDISTRITO)
                                .text(divisionTerritorial[2].Value[j].VC_DESCRIPCION));
                    }
                }
                var personaDistritoSel = $("#cmbPersonaDistrito").val();
                for (var j = 0; j < divisionTerritorial[2].Value.length; j++) {
                    if (divisionTerritorial[2].Value[j].I_IDPROVINCIA == personaProvinciaSel &&
                        divisionTerritorial[2].Value[j].I_IDCANTON == personaCantonSel &&
                        divisionTerritorial[2].Value[j].I_IDDISTRITO == personaDistritoSel) {
                        var distritoSeleccionado = divisionTerritorial[2].Value[j];
                        $("#cmbPersonaRegion").val(distritoSeleccionado.I_IDREGION);
                    }
                }

            });
        $("#cmbPersonaCanton")
            .change(function () {
                var personaCantonSel = $("#cmbPersonaCanton").val();
                var personaProvinciaSel = $("#cmbPersonaProvincia").val();
                $('#cmbPersonaDistrito').find('option').remove().end();
                var personaCantonSel = $("#cmbPersonaCanton").val();
                for (var j = 0; j < divisionTerritorial[2].Value.length; j++) {
                    //console.log(data[0].Value[j].VC_DESCRIPCION);
                    if (divisionTerritorial[2].Value[j].I_IDCANTON == personaCantonSel &
                        divisionTerritorial[2].Value[j].I_IDPROVINCIA == personaProvinciaSel) {
                        $("#cmbPersonaDistrito")
                            .append($("<option />")
                                .val(divisionTerritorial[2].Value[j].I_IDDISTRITO)
                                .text(divisionTerritorial[2].Value[j].VC_DESCRIPCION));
                    }
                }
                var personaDistritoSel = $("#cmbPersonaDistrito").val();
                for (var j = 0; j < divisionTerritorial[2].Value.length; j++) {
                    if (divisionTerritorial[2].Value[j].I_IDPROVINCIA == personaProvinciaSel &&
                        divisionTerritorial[2].Value[j].I_IDCANTON == personaCantonSel &&
                        divisionTerritorial[2].Value[j].I_IDDISTRITO == personaDistritoSel) {
                        var distritoSeleccionado = divisionTerritorial[2].Value[j];
                        $("#cmbPersonaRegion").val(distritoSeleccionado.I_IDREGION);
                    }
                }

            });
        $("#cmbPersonaDistrito")
            .change(function () {
                var personaCantonSel = $("#cmbPersonaCanton").val();
                var personaProvinciaSel = $("#cmbPersonaProvincia").val();
                var personaDistritoSel = $("#cmbPersonaDistrito").val();
                for (var j = 0; j < divisionTerritorial[2].Value.length; j++) {
                    if (divisionTerritorial[2].Value[j].I_IDPROVINCIA == personaProvinciaSel &&
                        divisionTerritorial[2].Value[j].I_IDCANTON == personaCantonSel &&
                        divisionTerritorial[2].Value[j].I_IDDISTRITO == personaDistritoSel) {
                        var distritoSeleccionado = divisionTerritorial[2].Value[j];
                        $("#cmbPersonaRegion").val(distritoSeleccionado.I_IDREGION);
                    }
                }

            });


        for (var j = 0; j < divisionTerritorial[0].Value.length; j++) {
            //console.log(data[0].Value[j].VC_DESCRIPCION);
            $("#cmbPersonaProvincia")
                .append($("<option />")
                    .val(divisionTerritorial[0].Value[j].I_IDPROVINCIA)
                    .text(divisionTerritorial[0].Value[j].VC_DESCRIPCION));
        }
        var empresaProvinciaSel = $("#cmbPersonaProvincia").val();
        for (var j = 0; j < divisionTerritorial[1].Value.length; j++) {
            //console.log(data[0].Value[j].VC_DESCRIPCION);
            if (divisionTerritorial[1].Value[j].I_IDPROVINCIA == empresaProvinciaSel) {
                $("#cmbPersonaCanton")
                    .append($("<option />")
                        .val(divisionTerritorial[1].Value[j].I_IDCANTON)
                        .text(divisionTerritorial[1].Value[j].VC_DESCRIPCION));
            }

        }


        var empresaCantonSel = $("#cmbPersonaCanton").val();
        for (var j = 0; j < divisionTerritorial[2].Value.length; j++) {
            //console.log(data[0].Value[j].VC_DESCRIPCION);
            if (divisionTerritorial[2].Value[j].I_IDCANTON == empresaCantonSel &
                divisionTerritorial[2].Value[j].I_IDPROVINCIA == empresaProvinciaSel) {
                $("#cmbPersonaDistrito")
                    .append($("<option />")
                        .val(divisionTerritorial[2].Value[j].I_IDDISTRITO)
                        .text(divisionTerritorial[2].Value[j].VC_DESCRIPCION));
            }

        }

        for (var j = 0; j < divisionTerritorial[3].Value.length; j++) {
            $("#cmbPersonaRegion")
                .append($("<option />").val(divisionTerritorial[3].Value[j].I_IDREGION).text(divisionTerritorial[3].Value[j].VC_DESCRIPCION));
        }
    }


    function CargarEditorRedesApoyo() {
        $("select option").prop("selected", false);
        $("#frmEditorRedesApoyo").hide();

        $("#cmdTipoRedApoyo").change(function () {
            debugger;
            var idTipoRed = $("#cmdTipoRedApoyo").val();
            if (idTipoRed === "717") {
                $("#contenedorRelacion").hide();
                $("#contenedorInstitucion").show();
            }
            else {

                $("#contenedorRelacion").show();
                $("#contenedorInstitucion").hide();

            }

        });
        $("#btnOcultarCampoRedApoyo").click(function (event) {
            debugger;
            event.preventDefault();
            $("#frmEditorRedesApoyo").hide();
        });
        $("#cmdTipoRedApoyo").val([]);
        $("#txtNombre").val("");
        $("#cmdInstitucionRedApoyo").val([]);
        $("#contenedorRelacion").val("");
        $("#txtTelefono").val("");
        $("#cmdTipoRedApoyo").val("717").trigger('change');
        var tablaRedesApoyo = $('#tblRedesApoyo').DataTable({
            responsive: true,
            dom: 'Brtlp<"clear">',
            select: true,
            buttons: [
                {
                    extend: 'excelHtml5',
                    text: '<i class="fa fa-file-excel-o"></i>',
                    titleAttr: 'Excel'
                }, {
                    extend: 'pdfHtml5',
                    text: '<i class="fa fa-file-pdf-o"></i>',
                    titleAttr: 'PDF'
                }, {
                    text: '<i class="fa fa-plus-circle btnBlanco" aria-hidden="true"></i>',
                    titleAttr: 'Agregar una red de Apoyo',
                    className: 'botonEstandar',
                    action: function (e, dt, node, config) {

                        $('.redApoyo').val('');

                        $("#frmEditorRedesApoyo").fadeIn();

                    }
                }, {
                    text: '<i class="fa fa-minus-circle btnBlanco" aria-hidden="true"></i>',
                    titleAttr: 'Eliminar una red de Apoyo',
                    className: 'botonEstandar',
                    action: function (e, dt, node, config) {
                        debugger;

                        var contSeleccionados = tablaRedesApoyo.rows({
                            selected: true
                        }).count();
                        var filaSeleccionada = tablaRedesApoyo.rows({
                            selected: true
                        }).data();
                        if (contSeleccionados > 0) {

                            tablaRedesApoyo.row('.selected').remove().draw();
                        } else {
                            $("#txtModalTitulo").css("color", "red");
                            $("#txtModalTitulo").text("No se seleccionaron redes de apoyo");
                            $("#txtModalContenido").text("Seleccione una red de apoyo para continuar");
                            instMensajes.open();
                        }

                        debugger;
                    }
                }
            ],
            "language": {
                "sProcessing": "Procesando...",
                "sLengthMenu": "Mostrar _MENU_ registros",
                "sZeroRecords": "No se encontraron resultados",
                "sEmptyTable": "Ningún dato disponible en esta tabla",
                "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
                "sInfoPostFix": "",
                "sSearch": "Buscar:",
                "sUrl": "",
                "sInfoThousands": ",",
                "sLoadingRecords": "Cargando...",
                "oPaginate": {
                    "sFirst": "Primero",
                    "sLast": "Último",
                    "sNext": "Siguiente",
                    "sPrevious": "Anterior"
                },
                "oAria": {
                    "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
                    "sSortDescending": ": Activar para ordenar la columna de manera descendente"
                }
            },
            "processing": true, // for show progress bar
            "serverSide": false, // for process server side
            "filter": true, // this is for disable filter (search box)
            "orderMulti": false, // for disable multiple column at once
            tableTools: {
                "sRowSelect": "single"
            },
            "columns": [
                {
                    "data": "PK_REDAPOYO",
                    "name": "PK_REDAPOYO",
                    "autoWidth": true,
                    "visible": false
                }, {
                    "data": "FK_INSTITUCION",
                    "name": "FK_INSTITUCION",
                    "autoWidth": true,
                    "visible": false
                }, {
                    "data": "FK_TIPORED",
                    "name": "FK_TIPORED",
                    "autoWidth": true,
                    "visible": false
                }, {
                    "data": "NOMBRE",
                    "name": "NOMBRE",
                    "autoWidth": true,
                    "visible": true
                }, {
                    "data": "RELACION",
                    "name": "RELACION",
                    "autoWidth": true,
                    "visible": true
                }, {
                    "data": "TELEFONO",
                    "name": "TELEFONO",
                    "autoWidth": true
                }, {
                    "data": "TIPORED",
                    "name": "TIPORED",
                    "autoWidth": true
                }, {
                    "data": "INSTITUCION",
                    "name": "INSTITUION",
                    "autoWidth": true
                }
            ]

        });
        $('#tblRedesApoyo tbody').on('click', 'tr', function () {
            debugger;
            if ($(this).hasClass('selected')) {


                //$("tr").removeClass("selectedDT");
                $("#tblRedesApoyo tr").removeClass("selectedDT");
                $("#tblRedesApoyo tr").removeClass("selected");
                $(this).addClass('selected');
                $(this).addClass('selectedDT');
            } else {
                $(this).removeClass('selectedDT');

            }
        });
        $("#btnGuardarRedApoyo").click(function () {
            debugger;
            var algo = $("#cmdTipoRedApoyo").val();
            if ($("#cmdTipoRedApoyo").val() !== ''
                && $("#txtNombreRedApoyo").length > 0
                && $("#txtTelefonoRedApoyo").length > 0) {

                tablaRedesApoyo.row.add({
                    "PK_REDAPOYO": '',
                    "FK_INSTITUCION": $("#cmdInstitucionRedApoyo").val(),
                    "FK_TIPORED": $("#cmdTipoRedApoyo").val(),
                    "NOMBRE": $("#txtNombreRedApoyo").val(),
                    "RELACION": $("#txtRelacionRedApoyo").val(),
                    "TELEFONO": $("#txtTelefonoRedApoyo").val(),
                    "TIPORED": $("#cmdTipoRedApoyo option:selected").text(),
                    "INSTITUCION": $("#cmdInstitucionRedApoyo option:selected").text()

                }).draw();
                $('.redApoyo').val('');

            } else {


                $("#txtModalTitulo").css("color", "red");
                $("#txtModalTitulo").text("Error al registrar red de Apoyo");
                $("#txtModalContenido").text("El formulario se encuentra incompleto");
                instMensajes.open();

            }


        });
    }

    function CargarEditorComposicionFamiliar() {
        $("select option").prop("selected", false);
        $("#frmEditorComposicionFamiliar").hide();
        $("#btnOcultarCampoComposicionFamiliar").click(function (event) {
            debugger;
            event.preventDefault();
            $("#frmEditorComposicionFamiliar").hide();
        });
        $("#txtNombreFamiliar").val("");
        $("#cmbParentescoFamiliar").val([]);
        $("#txtEdadFamiliar").val("");
        $("#cmbEscolaridadFamiliar").val([]);
        $("#cmbOcupacionFamiliar").val([]);
        var tablaComposicionFamiliar = $('#tblComposicionFamiliar').DataTable({
            responsive: true,
            dom: 'Brtlp<"clear">',
            select: true,
            buttons: [
                {
                    extend: 'excelHtml5',
                    text: '<i class="fa fa-file-excel-o"></i>',
                    titleAttr: 'Excel'
                }, {
                    extend: 'pdfHtml5',
                    text: '<i class="fa fa-file-pdf-o"></i>',
                    titleAttr: 'PDF'
                }, {
                    text: '<i class="fa fa-plus-circle btnBlanco" aria-hidden="true"></i>',
                    titleAttr: 'Agregar un familiar',
                    className: 'botonEstandar',
                    action: function (e, dt, node, config) {

                        $('.composicionFamiliar').val('');

                        $("#frmEditorComposicionFamiliar").fadeIn();

                    }
                }, {
                    text: '<i class="fa fa-minus-circle btnBlanco" aria-hidden="true"></i>',
                    titleAttr: 'Eliminar un familiar',
                    className: 'botonEstandar',
                    action: function (e, dt, node, config) {
                        debugger;

                        var contSeleccionados = tablaComposicionFamiliar.rows({
                            selected: true
                        }).count();
                        var filaSeleccionada = tablaComposicionFamiliar.rows({
                            selected: true
                        }).data();
                        if (contSeleccionados > 0) {

                            tablaComposicionFamiliar.row('.selected').remove().draw();
                        } else {
                            $("#txtModalTitulo").css("color", "red");
                            $("#txtModalTitulo").text("No se seleccionaron familiares");
                            $("#txtModalContenido").text("Seleccione un familiar para continuar");
                            instMensajes.open();
                        }

                        debugger;
                    }
                }
            ],
            "language": {
                "sProcessing": "Procesando...",
                "sLengthMenu": "Mostrar _MENU_ registros",
                "sZeroRecords": "No se encontraron resultados",
                "sEmptyTable": "Ningún dato disponible en esta tabla",
                "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
                "sInfoPostFix": "",
                "sSearch": "Buscar:",
                "sUrl": "",
                "sInfoThousands": ",",
                "sLoadingRecords": "Cargando...",
                "oPaginate": {
                    "sFirst": "Primero",
                    "sLast": "Último",
                    "sNext": "Siguiente",
                    "sPrevious": "Anterior"
                },
                "oAria": {
                    "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
                    "sSortDescending": ": Activar para ordenar la columna de manera descendente"
                }
            },
            "processing": true, // for show progress bar
            "serverSide": false, // for process server side
            "filter": true, // this is for disable filter (search box)
            "orderMulti": false, // for disable multiple column at once
            tableTools: {
                "sRowSelect": "single"
            },
            "columns": [
                {
                    "data": "PK_FAMILIAR",
                    "name": "PK_FAMILIAR",
                    "autoWidth": true,
                    "visible": false
                }, {
                    "data": "PK_PERSONA",
                    "name": "PK_PERSONA",
                    "autoWidth": true,
                    "visible": false
                }, {
                    "data": "FK_PARENTESCO_PERSONA",
                    "name": "FK_PARENTESCO_PERSONA",
                    "autoWidth": true,
                    "visible": false
                }, {
                    "data": "FK_ESCOLARIDAD",
                    "name": "FK_ESCOLARIDAD",
                    "autoWidth": true,
                    "visible": false
                }, {
                    "data": "FK_OCUPACION",
                    "name": "FK_OCUPACION",
                    "autoWidth": true,
                    "visible": false
                }, {
                    "data": "Nombre",
                    "name": "Nombre",
                    "autoWidth": true,
                    "visible": true
                }, {
                    "data": "Parentesco",
                    "name": "Parentesco",
                    "autoWidth": true,
                    "visible": true
                }, {
                    "data": "Edad",
                    "name": "Edad",
                    "autoWidth": true,
                    "visible": true
                }, {
                    "data": "Escolaridad",
                    "name": "Escolaridad",
                    "autoWidth": true
                }, {
                    "data": "Ocupación",
                    "name": "Ocupación",
                    "autoWidth": true,
                    "visible": true
                }
            ]

        });
        $('#tblComposicionFamiliar tbody').on('click', 'tr', function () {
            debugger;
            if ($(this).hasClass('selected')) {


                //$("tr").removeClass("selectedDT");
                $("#tblComposicionFamiliar tr").removeClass("selectedDT");
                $("#tblComposicionFamiliar tr").removeClass("selected");
                $(this).addClass('selected');
                $(this).addClass('selectedDT');
            } else {
                $(this).removeClass('selectedDT');

            }
        });
        $("#btnGuardarComposicionFamiliar").click(function () {
            debugger;
            if ($("#cmbParentescoFamiliar").val() !== ''
                && $("#txtNombreFamiliar").length > 0
                && $("#cmbOcupacionFamiliar").val() !== ''
                && $("#txtEdadFamiliar").length > 0
                && $("#cmbEscolaridadFamiliar").val !== '') {

                tablaComposicionFamiliar.row.add({
                    "PK_FAMILIAR": '',
                    "PK_PERSONA": '',
                    "FK_PARENTESCO_PERSONA": $("#cmbParentescoFamiliar").val(),
                    "FK_ESCOLARIDAD": $("#cmbEscolaridadFamiliar").val(),
                    "FK_OCUPACION": $("#cmbOcupacionFamiliar").val(),
                    "Nombre": $("#txtNombreFamiliar").val(),
                    "Parentesco": $("#cmbParentescoFamiliar option:selected").text(),
                    "Edad": $("#txtEdadFamiliar").val(),
                    "Escolaridad": $("#cmbEscolaridadFamiliar option:selected").text(),
                    "Ocupación": $("#cmbOcupacionFamiliar option:selected").text()
                }).draw();
                $('.composicionFamiliar').val('');

            } else {


                $("#txtModalTitulo").css("color", "red");
                $("#txtModalTitulo").text("Error al registrar familiar");
                $("#txtModalContenido").text("El formulario se encuentra incompleto");
                instMensajes.open();

            }


        });
    }
    

    function fechaHoy() {
        var hoy = new Date();
        var dd = hoy.getDate();
        var mm = hoy.getMonth() + 1; //hoy es 0!
        var yyyy = hoy.getFullYear();

        if (dd < 10) {
            dd = '0' + dd
        }

        if (mm < 10) {
            mm = '0' + mm
        }

        hoy = mm + '/' + dd + '/' + yyyy;
        $("#txtFechaHoy").val(hoy);
    }

    function mostrarHora() {
        var f = new Date();
        minutos = f.getMinutes();
        temp = minutos;
        if (minutos < 10) {
            temp = "0" + temp;
        }
        cad = f.getHours() + ":" + temp;
        window.status = cad;
        setTimeout("mostrarhora()", 1000);
        $("#txtHoraInicio").val(cad);
    }

</script>


<style>
    input, select, textarea {
        max-width: 100%;
        padding: 4px;
    }

    input {
        background-color: blue;
    }

    .inlineCheckBox {
        display: inline-block;
        vertical-align: middle;
    }
</style>


<div class="container-fluid" id="contenedorPrincipal" style="background-color: whitesmoke;border: 1px solid #E3E3E3;border-radius: 4px;">
    <div class="col-md-12 form-group">
        <div class="col-md-2 form-group">
            <button type="button" id="btnExpediente" class="btn btn-default btn-responsive" style="text-align:center; margin-bottom:5px; margin-top:50px; display: block; width: 100%; color: white; background-color: #368DE9; border-color: #368DE9;">Expediente</button>

            <button type="button" id="btnReferencias" class="btn btn-default btn-responsive" style="text-align:center; margin-bottom:5px; display: block; width: 100%; color: white; background-color: #368DE9; border-color: #368DE9;">Referencias</button>

            <button type="button" id="btnHistorial" class="btn btn-default btn-responsive" style="text-align:center; margin-bottom:5px; display: block; width: 100%; color: white; background-color: #368DE9; border-color: #368DE9;">Historiales</button>

            <button type="button" id="btnCrearCaso" class="btn btn-default btn-responsive" style="text-align:center; margin-bottom:5px;display: block; width: 100%; color: white; background-color: #FA8258; border-color: #FA8258;">Crear Caso</button>

            <button type="button" id="btnCerrarCaso" class="btn btn-default btn-responsive" style="text-align:center; margin-bottom:5px; display: block; width: 100%; color: white; background-color: #FA8258; border-color: #FA8258;">Cerrar Caso</button>
        </div>

        <div class="col-md-10 form-group">
            <form id="formDelegacion" method="post">
                <div style="margin-left:20px;">
                    @*<h2>Expediente de: @Model.persona.VC_NOMBRE @Model.persona.VC_APELLIDO1 @Model.persona.VC_APELLIDO2</h2>
                        <h4>Identificación: @Model.persona.VC_IDENTIFICACION <br /> Número de expediente: @Model.persona.PK_PERSONA</h4>*@
                </div>
                <ul class="nav nav-tabs">
                    <li class="active">
                        <a data-toggle="tab" href="#datAdministrativos">
                            <i class="fa fa-file-text" aria-hidden="true"></i>Datos Administrativos
                        </a>
                    </li>
                    <li>
                        <a data-toggle="tab" href="#datUsuaria">
                            <i class="fa fa-address-card" aria-hidden="true"></i>Datos Usuaria
                        </a>
                    </li>
                    <li>
                        <a data-toggle="tab" href="#datPerfil">
                            <i class="fa fa-address-card" aria-hidden="true"></i>Perfil
                        </a>
                    </li>
                    <li>
                        <a data-toggle="tab" href="#historialViolencia">
                            <i class="fa fa-pencil-square-o" aria-hidden="true"></i>Historial de violencia
                        </a>
                    </li>
                    <li>
                        <a data-toggle="tab" href="#atencion">
                            <i class="fa fa-hand-paper-o" aria-hidden="true"></i>Atención
                        </a>
                    </li>
                    <li>
                        <a data-toggle="tab" href="#intervencion">
                            <i class="fa fa-hand-paper-o" aria-hidden="true"></i>Intervención
                        </a>
                    </li>
                </ul>

                <div class="tab-content">
                    <div id="datAdministrativos" class="tab-pane fade in active">
                        @Html.Action("DatAdministrativosDele", "Expediente")
                    </div>
                    <div id="datUsuaria" class="tab-pane">
                        @Html.Action("DatUsuariaDele", "Expediente")
                    </div>
                    <!--Inicia pestaña Datos de perfil de usuaria-->
                    <div id="datPerfil" class="tab-pane">
                        @Html.Action("DatPerfil", "Expediente")
                    </div>
                    <!--Finaliza pestaña Datos de perfil de usuaria-->
                    <div id="historialViolencia" class="tab-pane">
                        @Html.Action("HistorialViolenciaDele", "Expediente")
                    </div>
                    <div id="atencion" class="tab-pane">
                        <div class="row comunForm">

                            <div class="row">
                                <div class="col-md-4 form-group">
                                    <label>Atención</label>

                                    <input class="form-control" placeholder="Nombre" id="txtNombre4" type="date" required="">
                                </div>

                            </div>

                        </div>
                    </div>
                    <div id="intervencion" class="tab-pane">
                        <div class="row comunForm">

                            <div class="row">
                                <div class="col-md-4 form-group">
                                    <label>Intervencion</label>

                                    <input class="form-control" placeholder="Nombre" id="txtNombre4" type="date" required="">
                                </div>

                            </div>

                        </div>
                    </div>

                </div>



            </form>
        </div>
    </div>
</div>


